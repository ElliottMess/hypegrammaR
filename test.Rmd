---
title: "Hedi_test"
author: "ElioraH"
date: "16 May 2019"
output: html_document
---

```{r setup, include=TRUE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r test}
library(hypegrammaR)
library(knitr)

assessment_data <- load_data(file = "./tests/testthat/test_data/example1/testdata.csv")
sampling_frame <- load_samplingframe(file = "./tests/testthat/example1/test_samplingframe.csv")
questionnaire <- load_questionnaire(data = assessment_data,
                                    questions = "./tests/testthat/example1/test_questionnaire_questions.csv",
                                    choices = "./tests/testthat/example1/test_questionnaire_choices.csv",
                                    choices.label.column.to.use = "label::English")
weighting <- map_to_weighting(sampling.frame = sampling_frame,
                              data.stratum.column = "stratification",
                              sampling.frame.population.column = "population",
                              sampling.frame.stratum.column = "strata.names",
                              data = assessment_data)

case <- map_to_case(hypothesis.type = "group_difference",
                    dependent.var.type = "categorical",
                    independent.var.type = "categorical")
result <- map_to_result(data = assessment_data,
                        dependent.var = "hhexperienced",
                        independent.var = "region",
                        case = case,
                        weighting = weighting)
result_labeled <- map_to_labeled(result, questionnaire = questionnaire)
chart <- map_to_visualisation(result)
heatmap <- map_to_visualisation_heatmap(result)
map_to_file(chart$ggplot,"barchart.jpg")
map_to_file(result$summary.statistic, "summary_statistics.csv")

##################################################################################

analysisplan <- load_analysisplan(file = "./tests/testthat/test_analysisplan.csv")
list_of_result <- assessment_data %>% from_analysisplan_map_to_output(analysisplan = analysisplan,
                                                                      weighting = weighting,
                                                                      questionnaire = questionnaire)

list_of_result %>% map_to_template(questionnaire = questionnaire,
                                   dir = "./",
                                   filename = "my_example.html")

#### MAP TO FILE WITH LABELS NOT XML NAMES 

list_of_result$results %>% lapply(function(x){x$summary.statistic}) %>% do.call(rbind,.) %>% map_to_file("./master_table_long.csv")


#########################################################

result_example <- assessment_data %>% map_to_result(dependent.var = "health_need",
                                                    independent.var = "region",
                                                    case = case,
                                                    weighting = weighting,
                                                    questionnaire = questionnaire)

vis <- result_example %>% map_to_labeled(questionnaire = questionnaire) %>% map_to_visualisation

case2 <- map_to_case(hypothesis.type = "group_difference",
                     dependent.var.type = "categorical",
                     independent.var.type = 'categorical')

design <- assessment_data  %>% map_to_design(weighting_function = weighting)

sumstat<-map_to_summary_statistic(design,"hhexperienced","region",case = case2,questionnaire = questionnaire)

edu1<-map_to_result(assessment_data,dependent.var = "hhexperienced",independent.var = 'region',case = case2 ,questionnaire = questionnaire)
